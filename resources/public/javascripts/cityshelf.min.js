var CityShelf=angular.module("CityShelf",["ngResource","ngRoute","ionic","google-maps"]);CityShelf.controller("GeolocationCtrl",["$scope","$location","Geolocation",function(a,b,c){"use strict";a.form={},a.geolocate=function(){c.geolocate(a.form.location),b.path("/search")}}]),CityShelf.controller("MainCtrl",["$scope","$location","Search","Geolocation",function(a,b,c,d){"use strict";function e(a,b){setTimeout(function(){b()},a)}var f=8,g=3e3;a.form={},a.loading=!1;var h=function(){b.path("/geolocation")};a.setLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){d.set(a.coords.latitude,a.coords.longitude),b.path("/search")},h,{timeout:g}):b.path("/geolocation")},a.search=function(){a.loading=!0,d.fetch().length?e(1e3,function(){b.path("/search")}):a.setLocation(),c.flush();for(var g=0;f>g;g++)c.execute(a.form.book,g)}}]),CityShelf.controller("SearchCtrl",["$scope","$http","Search","Geolocation",function(a,b,c,d){"use strict";a.results=c.fetch(),a.options=["proximity","price"],a.sortBy=function(){return function(b){return"price"===a.selected?b.price:"proximity"===a.selected?d.proximity(d.fetch(),[b.map.center.latitude,b.map.center.longitude]):b.availability}},a.selected=a.options[0],a.select=function(b){a.selected=b},a.showSearch=!0,a.showMap=!1,a.searchQuery=c.getQuery()}]),CityShelf.filter("capitalize",function(){"use strict";var a=["a","an","as","at","and","but","for","from","in","is","of","on","the","to"],b=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};return function(c){if(c){for(var d=c.split(" "),e=[],f=0;f<d.length;f++)e.push(b(a,d[f])&&0!==f?d[f]:d[f].charAt(0).toUpperCase()+d[f].substr(1).toLowerCase());return e.join(" ")}return""}}),CityShelf.filter("truncate",function(){"use strict";return function(a,b,c){return isNaN(b)&&(b=35),void 0===c&&(c="..."),a.length<=b||a.length-c.length<=b?a:String(a).substring(0,b-c.length)+c}}),CityShelf.config(["$routeProvider","$locationProvider",function(a,b){"use strict";a.when("/",{controller:"MainCtrl",templateUrl:"templates/main.html"}).when("/search",{controller:"SearchCtrl",templateUrl:"templates/search.html"}).when("/geolocation",{controller:"GeolocationCtrl",templateUrl:"templates/geolocation.html"}).otherwise({templateUrl:"templates/404.html"}),b.html5Mode(!0),b.hashPrefix("!")}]),CityShelf.factory("Geolocation",[function(){"use strict";var a=function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2))},b=[],c=function(a,c){b=[a,c]},d=function(){return b},e=function(a){var b=new google.maps.Geocoder,d=a;b.geocode({address:d},function(a,b){if(b===google.maps.GeocoderStatus.OK){var d=a[0].geometry.location.k,e=a[0].geometry.location.B;c(d,e)}})};return{fetch:d,geolocate:e,proximity:a,set:c}}]),CityShelf.factory("Search",["Store",function(a){"use strict";var b=[],c="",d=function(d,e){c=d,a.query({id:e,query:d}).$promise.then(function(a){b=b.concat(a)})},e=function(){return b},f=function(){b=[]},g=function(){return c};return{execute:d,fetch:e,flush:f,getQuery:g}}]),CityShelf.factory("Store",["$resource",function(a){"use strict";return a("/api/stores/:id/?query=:query",{id:"@id"})}]);